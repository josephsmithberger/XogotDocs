@Tutorial(time: 15) {
    @Intro(title: "Finishing up") {
            
            We have now completed all the functionality for our game. This lesson will
            cover some remaining steps to improve the game experience.
            
            Feel free to expand the gameplay with your own ideas.
        @Image(source: dodge_preview.gif)
    }
    @Section(title: "Background") {
        @ContentAndMedia {
            The default gray background is not very appealing, so let's change it to a fun background image!
            
        }
        @Steps {
            One way to make the background more interesting is to use a
            [`TextureRect`](https://docs.godotengine.org/en/stable/classes/class_texturerect.html) 
            node to add an image texture. Let's use that to make this feel like a real game!
            @Step {
                Make a new TextureRect and move it to be the first node under `Main` so that it will be drawn behind the other nodes. Rename it "Background".
                
                >Tip: In Xogot 2D scenes, Nodes are drawn bottom to top. Because of this, any nodes you want in the background need to be higher in the scene tree.
                
                @Image(source: fin_texturerect_rename.png)
            }
            @Step {
                `TextureRect` only has one main property: **Texture**. Choose our background image in the assets folder. Click **Pick Resource** (1) and then select Background.png (2).
                
                @Image(source: fin_picktexture.png)
            }
            @Step {
                Next, to make it cover the screen,  grab the bottom corner and drag it to cover the viewport (1). 
                Then under `Expand Mode` set the mode to **Fit Width Proportional** (2).
                
                You could also add just make your background a color, if you prefer, by using a
                [`ColorRect`](https://docs.godotengine.org/en/stable/classes/class_colorrect.html#class-colorrect+) 
                node instead.
                
                @Image(source: fin_resizetexture.png)
            }
        }
    }
    @Section(title: "Sound effects") {
        @ContentAndMedia {
            Sound and music can be the single most effective way to add appeal to the game
            experience. 
            
            In your game's **art** folder, you have two sound files: "House In a
            Forest Loop.ogg" for background music, and "gameover.wav" for when the player
            loses.
        }
        @Steps {
            @Step {
                Add two 
                [`AudioStreamPlayer`](https://docs.godotengine.org/en/stable/classes/class_audiostreamplayer.html#class-audiostreamplayer) 
                nodes as children of `Main`. 
                
                Name one of them `Music` and the other `DeathSound`. 
                
                @Image(source: fin_audio.png)
            }
            @Step {
                Select the **`DeathSound`** `AudioStreamPlayer` you just created, open the 
                Inspector, and tap **Pick Resource** next to the **`Stream`** property.
                Select **Quick Load**, and choose the "gameover.wav" audio file.  
                
                > Important:Repeat this process to load the music loop for the **`Music`** `AudioStreamPlayer`.
                
                @Image(source: fin_gameover.png)
            }
            All audio is automatically imported with the `Loop` setting disabled.
            @Step {
                If you want the music loop seamlessly, tap the **...** next to the 
                Stream file name and select **Make Unique** (1). Then, select **Inspect** (2) 
                in the **...** menu and enable **Loop**.
                
                @Image(source: fin_music_loop.png)
            }
            @Step {
                To play the music, add `$Music.play()` in the `new_game()`
                function.
                
                @Code(name: "main.gd", file: main-14.gd, previousFile: main-13.gd)
            }
            @Step {
                And call `$Music.stop()` to the `game_over()` function to stop the music
                when the game is over.
                
                @Code(name: "main.gd", file: main-15.gd)
            }
            @Step {
                
                
                Finally, add `$DeathSound.play()` in the `game_over()` function.
                
                @Code(name: "main.gd", file: main-16.gd)
            }
        }
    }
    @Section(title: "Joypad Buttons and Keyboard Shortcuts") {
        @ContentAndMedia {
            Since the game is played with a joypad, it would be convenient if we
            could also start the game by pressing a button on the joypad. We can do this with
            the "Shortcut" property of the `Button` node.
            
            In a previous lesson, we created four input actions to move the character. We
            will create a similar input action to map to the start button.
        }
        @Steps {
            @Step {
                First, tap on the **...** toolbar button in the upper-right corner
                of Xogot and tap **Settings** to open the *Project Settings* dialog.
                In *Project Settings*, tap the dropdown arrow next to **General** and 
                select **Input Map**. 
                
                In the same way you created the movement input actions previously, create 
                a new input action (1) named `start_game` (2) and add a **Joypad Buttons**  
                mapping (3) for the `Bottom Action` button (4) (or whatever joypad button you 
                prefer to use to start the game).
                
                @Image(source: fin_start_mapping.png)
            }
            The next step is optional and can be skipped if you plan to keep your game on mobile, but will make the game more accessible for a wider audience.
            @Step {
                Optional: To support desktop gamers with only a keyboard, now would be 
                a good time to add **Keyboard Keys** mappings, if you haven't already.
                
                For each `move` input action, you can add additional mappings for 
                **W**, **A**, **S**, **D** and/or 
                **Left**, **Right**, **Up**, **Down** arrow keys.  **Enter** and/or **Space**
                can be mapped to `start_game`.
                
                @Image(source: fin_start_keyboard.png)
            }
            @Step {
                In the `HUD` scene, select the `StartButton` and tap **Shortcut** at the 
                bottom of the `BaseButton` section in the Inspector.  
                
                Tap **Pick Resource** next to the **Shortcut** property and tap **New Shortcut** 
                to create a new 
                [`Shortcut`](https://docs.godotengine.org/en/stable/classes/class_shortcut.html#class-shortcut) 
                resource.  
                
                @Image(source: start_button_shortcut.png)
            }
            @Step {
                Tap the newly created **Shortcut** to navigate into the Shortcut resource
                and then tap the **InputEvent Array [0]** to edit the array.
                
                @Image(source: start_shortcut_resource.png)
            }
            @Step {
                In the Array Editor dialog, tap **Add** (1) to add a new element to the array.
                
                On the new empty row [0], tap the **...** (2) and create a **New InputEventAction**.
                
                @Image(source: start_array.png)
            }
            @Step {
                Tap **InputEventAction** in row [0] to edit the new 
                [`InputEventAction`](https://docs.godotengine.org/en/stable/classes/class_inputeventaction.html#class-inputeventaction).  
                
                Set its action to "**start_game**".  Tap **Back** to return to the array and then
                tap **Save**.
                
                @Image(source: start_action.png)
            }
            @Step {
                Now when the start button appears, you can either tap it or press the 
                `Enter` key or joypad bottom action button to start the game.
                
                @Image(source: start_action_done.png)
            }
            And with that, you have completed your first 2D game in Xogot.
        }
    }
    @Section(title: "Making your game even more customizable") {
        @ContentAndMedia {
            For extra credit: Let's make the controller a better more customizable experience for players by using an add-on from the Asset Library!
        }
        @Steps {
            We're going to use an add-on for Xogot called [*Virtual Joystick*](https://github.com/MarcoFazioRandom/Virtual-Joystick-Godot).
            @Step {
                Tap on the dropdown next to scope (1) and access the `Asset Library` (2)
                @Image(source: fin_asset_library_menu.png)
            }
            @Step {
                Find or search for Virtual Joystick (3) and once selected press **Import** (4).
                > Tip: There are lots of other add-ons for Xogot, with more being added all the time; trying out the available add-ons is a great way to learn Xogot.
                @Image(source: fin_asset_library_browser.png)
            }
            @Step {
                Exit the **Asset Library** and you should now have a `addons` folder in your working directory.
                Inside you'll find the `virtual_joystick` folder containing its scene.
                
                >Tip: You can also find example implementations inside the folder `test` if you'd like to dive deeper.
                @Image(source: fin_assets.png)
            }
            @Step {
                In the Main scene, with the Main node selected; Add a CanvasLayer node (1) and rename it to "UI" (2).
                @Image(source: fin_rename_ui.png)
            }
            @Step {
                With the new UI node selected; Instantiate a new child scene (1) and search for the Virtual Joystick scene: `virtual_joystick_scene.tscn` (2).
                
                Rename the node to "Virtual Joystick Left"
                
                @Image(source: fin_instantiate.png)
            }
            @Step {
                Select the Joystick node and in the Scope set the `Joystick Mode` to "Following" (1) and the `Visibility Mode` to "When Touched" (2)
                @Image(source: fin_joystick_settings.png)
            }
            @Step {
                Next, with the Scope still open, change `action_left` through to `action_down` to equal the names of the custom input actions we added in the project settings.
                
                It should look like this.
                
                > Important: Make sure you keep track of capitalization as these variables are case-sensitive.
                
                @Image(source: fin_actions.png)
            }
            @Step {
                With the Virtual Joystick Left node selected, inside the achors (1), set the anchor mode to `Full Rect` (2).
                @Image(source: fin_full_rect.png)
            }
            Finally, let's make sure the joystick is hidden when in the main menu, otherwise it would show whenever a player touched the screen. 
            
            To do this, we show() and hide() the parent CanvasLayer node in three spots throughout the main script.
            @Step {
                Next add the built in `_ready()` function above `game_over()` and inside add `$UI.hide()` to hide the UI CanvasLayer node and its children by default. 
                @Code(name: "main.gd", file: main-17.gd, previousFile: main-16.gd)
            }
            @Step {
                Next, inside `game_over()` add `$UI.hide()` to hide it when the player dies.
                @Code(name: "main.gd", file: main-18.gd, previousFile: main-17.gd)
            }
            @Step {
                Lastly, add `$UI.show()` inside `new_game()` to reveal the joystick when the player starts playing the game.
                @Code(name: "main.gd", file: main-19.gd, previousFile: main-18.gd)
            }
            We're done with the code, so go back to 2D mode.
            
            Now, we also need to disable the iOS virtual controller we enabled earlier in this tutorial. 
            @Step {
                Hit the dropdown next to scope, press Settings and then inside **Project Settings** go to **Input Devices > Virtual Controller** and set `Enable Controller` and `Enable Left Thumbstick` to **Disabled** by hitting the toggle switches.
                @Image(source: fin_project_settings.png)
            }
            With that, we are finally done customizing the new Virtual Controller! Congrats!
        }
    }
    @Section(title: "Sharing your game with others") {
        @ContentAndMedia {
            If you want people to try out your game, it's as easy as tapping `share`.
        }
        @Steps {
            @Step {
                Tap on the **&or;** (1) document toolbar button in the upper-left 
                corner of Xogot.

                @Image(source: fin_document_menu.png)
            }
            @Step {
                Select **Export Game** to open the *Share Game* dialog.
                    
                @Image(source: fin_export_web.png)
            }
            @Step {
                To share your game, you'll need to login.  You can tap the big 
                "Sign in with Apple" button to create an account or sign back in.
            
                @Image(source: fin_share_signin.png)
            }
            @Step {
                On the **Share Game** screen, you can provide a name that will
                be shown to players that you share your game with.
                
                The default name will come from your project settings.
            
                @Image(source: fin_share_screen.png)
            } 
            @Step {
                Tap **Build and Upload** to build your game and upload it.
            
                @Image(source: fin_upload.png)
            } 
            @Step {
                Congratulations!  Your game has been uploaded!
                
                Tap the URL to play your game in Safari.  Or, tap the share button 
                to share your game through Messages, AirDrop, etc.  Shared games can
                be played directly in the browser on any platform running an
                up-to-date browser.  
            
                @Image(source: fin_congratulations.png)
            } 
            @Step {
                You're done!  You learned to make a player-controlled character, enemies 
                that spawn randomly around the game board, count the score, implement
                a game over and replay, user interface, sounds, and more.
                
                Congratulations!
                
                @Image(source: dodge_preview.gif)
            }
            There's still much to learn, but you can take a moment to appreciate what you
            achieved and give yourself a pat on the back!
        }
    }
}
